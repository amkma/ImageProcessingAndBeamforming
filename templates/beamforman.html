{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beamforming Simulator | 2D Beamforming & Phased Array Modeling</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Your custom CSS -->
    <link rel="stylesheet" href="/static/css/beamforman.css">
    
</head>
<body>
    <!-- Loading indicator -->
    <div id="loading" style="display: none;">
        <div class="text-center">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <h3 class="mt-3">Loading Beamforming Simulator...</h3>
        </div>
    </div>

    <!-- Main Simulator Section -->
    <section class="simulator-container">
        <div class="container-fluid">
            <!-- Status Bar -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card-custom p-3">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <div class="d-flex align-items-center">
                                    <div class="status-indicator status-active me-2"></div>
                                    <div>
                                        <span>Simulation Active</span>
                                        <div class="text-small text-secondary">Update Rate: <span id="updateRate">60</span> FPS</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 text-center">
                                <div class="d-flex justify-content-center">
                                    <div class="mx-3">
                                        <small class="text-secondary d-block">Beam Angle</small>
                                        <span class="h6" id="mainLobeAngleDisplay">0Â°</span>
                                    </div>
                                    <div class="mx-3">
                                        <small class="text-secondary d-block">Intensity</small>
                                        <span class="h6" id="maxIntensityDisplay">1.0</span>
                                    </div>
                                    <div class="mx-3">
                                        <small class="text-secondary d-block">Elements</small>
                                        <span class="h6" id="activeElementsDisplay">8/8</span>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 text-end">
                                <button class="btn btn-simulator btn-sm me-2" id="quickSaveBtn">
                                    <i class="fas fa-save me-1"></i>Quick Save
                                </button>
                                <button class="btn btn-simulator-secondary btn-sm" id="quickLoadBtn">
                                    <i class="fas fa-upload me-1"></i>Load
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row g-4">
                <!-- Left Panel: Controls -->
                <div class="col-lg-4">
                    <div class="control-panel">
                        <!-- Array Selection Quick Access -->
                        <div class="card-custom mb-4">
                            <div class="card-body p-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">Active Array</h6>
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm btn-simulator" id="addArrayBtn">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                        <button class="btn btn-sm btn-simulator-danger" id="removeArrayBtn">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                                <select class="form-select form-control-custom mt-2" id="arraySelect">
                                    <option value="0">Array 1</option>
                                </select>
                            </div>
                        </div>

                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs nav-tabs-custom" id="controlTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="array-tab" data-bs-toggle="tab" 
                                        data-bs-target="#array-config" type="button">
                                    <i class="fas fa-layer-group me-2"></i>Array
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="beam-tab" data-bs-toggle="tab" 
                                        data-bs-target="#beam-config" type="button">
                                    <i class="fas fa-bullseye me-2"></i>Beam
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="scenario-tab" data-bs-toggle="tab" 
                                        data-bs-target="#scenario-config" type="button">
                                    <i class="fas fa-scroll me-2"></i>Scenarios
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="controlTabsContent">
                            <!-- Array Configuration Tab -->
                            <div class="tab-pane fade show active" id="array-config" role="tabpanel">
                                <!-- Array Properties -->
                                <div class="card-custom mb-4">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-cog me-2"></i>Array Properties</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label-custom">Array Name</label>
                                            <input type="text" class="form-control form-control-custom" 
                                                   id="arrayName" value="Array 1">
                                        </div>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label-custom">Elements</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="numElements" min="2" max="64" value="8">
                                                    <span class="slider-value" id="numElementsValue">8</span>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label-custom">Geometry</label>
                                                <select class="form-select form-control-custom" id="geometryType">
                                                    <option value="linear">Linear</option>
                                                    <option value="curved">Curved</option>
                                                    <option value="circular">Circular</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mb-3" id="curvatureControl" style="display: none;">
                                            <label class="form-label-custom">Curvature Radius (m)</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="curvature" min="0.1" max="5" step="0.1" value="1">
                                                <span class="slider-value" id="curvatureValue">1.0</span>
                                            </div>
                                        </div>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label-custom">Spacing (Î»)</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="elementSpacing" min="0.1" max="2" step="0.05" value="0.5">
                                                    <span class="slider-value" id="spacingValue">0.5</span>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label-custom">Freq (MHz)</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="frequency" min="1" max="10000" step="1" value="2400">
                                                    <span class="slider-value" id="frequencyValue">2400</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Position & Orientation -->
                                <div class="card-custom">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-arrows-alt me-2"></i>Position</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label-custom">X Position</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="posX" min="-10" max="10" step="0.1" value="0">
                                                    <span class="slider-value" id="posXValue">0</span>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label-custom">Y Position</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="posY" min="-10" max="10" step="0.1" value="0">
                                                    <span class="slider-value" id="posYValue">0</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="form-label-custom">Rotation</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="rotation" min="-180" max="180" value="0">
                                                <span class="slider-value" id="rotationValue">0Â°</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Beam Control Tab -->
                            <div class="tab-pane fade" id="beam-config" role="tabpanel">
                                <!-- Beam Steering -->
                                <div class="card-custom mb-4">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-crosshairs me-2"></i>Beam Steering</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label-custom">Steering Angle</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="steeringAngle" min="-90" max="90" value="0">
                                                <span class="slider-value" id="steeringAngleValue">0Â°</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label-custom">Focus Distance</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="focusDistance" min="0.1" max="20" step="0.1" value="5">
                                                <span class="slider-value" id="focusDistanceValue">5.0</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label-custom">Beam Width</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="beamWidth" min="1" max="90" value="30">
                                                <span class="slider-value" id="beamWidthValue">30Â°</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Phase Control -->
                                <div class="card-custom mb-4">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-wave-square me-2"></i>Phase Control</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label-custom">Phase Profile</label>
                                            <select class="form-select form-control-custom" id="phaseProfile">
                                                <option value="linear">Linear Phase</option>
                                                <option value="quadratic">Quadratic (Focusing)</option>
                                                <option value="custom">Custom</option>
                                                <option value="random">Random</option>
                                            </select>
                                        </div>
                                        <div class="mb-3" id="phaseSlopeControl">
                                            <label class="form-label-custom">Phase Slope</label>
                                            <div class="d-flex align-items-center">
                                                <input type="range" class="form-range flex-grow-1 me-3" 
                                                       id="phaseSlope" min="-180" max="180" value="0">
                                                <span class="slider-value" id="phaseSlopeValue">0Â°</span>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-simulator" id="resetPhasesBtn">
                                                <i class="fas fa-redo me-2"></i>Reset All Phases
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Element Control -->
                                <div class="card-custom">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-sliders-h me-2"></i>Element Control</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label-custom">Selected Element</label>
                                            <select class="form-select form-control-custom" id="selectedElement">
                                                <option value="0">Element 1</option>
                                                <option value="1">Element 2</option>
                                                <option value="2">Element 3</option>
                                                <option value="3">Element 4</option>
                                            </select>
                                        </div>
                                        <div class="row g-2">
                                            <div class="col-6">
                                                <label class="form-label-custom">Phase</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="elementPhase" min="-180" max="180" value="0">
                                                    <span class="slider-value" id="elementPhaseValue">0Â°</span>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <label class="form-label-custom">Amplitude</label>
                                                <div class="d-flex align-items-center">
                                                    <input type="range" class="form-range flex-grow-1 me-2" 
                                                           id="elementAmplitude" min="0" max="1" step="0.05" value="1">
                                                    <span class="slider-value" id="elementAmplitudeValue">1.0</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button class="btn btn-simulator-secondary" id="applyToAllBtn">
                                                <i class="fas fa-copy me-2"></i>Apply to All
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Scenarios Tab -->
                            <div class="tab-pane fade" id="scenario-config" role="tabpanel">
                                <!-- Predefined Scenarios -->
                                <div class="card-custom mb-4">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-star me-2"></i>Quick Scenarios</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-2">
                                            <!-- 5G Scenario -->
                                            <div class="col-12">
                                                <div class="scenario-card card-custom scenario-5g p-3" 
                                                     onclick="loadScenario('5g')">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-shrink-0">
                                                            <i class="fas fa-satellite-dish fa-2x" style="color: #3b82f6;"></i>
                                                        </div>
                                                        <div class="flex-grow-1 ms-3">
                                                            <h6 class="mb-1">5G Beam Steering</h6>
                                                            <p class="text-secondary small mb-0">
                                                                64-element linear array, 3.5 GHz
                                                            </p>
                                                        </div>
                                                        <i class="fas fa-chevron-right text-secondary"></i>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Ultrasound Scenario -->
                                            <div class="col-12">
                                                <div class="scenario-card card-custom scenario-ultrasound p-3" 
                                                     onclick="loadScenario('ultrasound')">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-shrink-0">
                                                            <i class="fas fa-wave-square fa-2x" style="color: #10b981;"></i>
                                                        </div>
                                                        <div class="flex-grow-1 ms-3">
                                                            <h6 class="mb-1">Ultrasound Imaging</h6>
                                                            <p class="text-secondary small mb-0">
                                                                128-element curved array, 5 MHz
                                                            </p>
                                                        </div>
                                                        <i class="fas fa-chevron-right text-secondary"></i>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Tumor Ablation -->
                                            <div class="col-12">
                                                <div class="scenario-card card-custom scenario-ablation p-3" 
                                                     onclick="loadScenario('ablation')">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-shrink-0">
                                                            <i class="fas fa-bullseye fa-2x" style="color: #ef4444;"></i>
                                                        </div>
                                                        <div class="flex-grow-1 ms-3">
                                                            <h6 class="mb-1">Tumor Ablation</h6>
                                                            <p class="text-secondary small mb-0">
                                                                256-element array, 1 MHz
                                                            </p>
                                                        </div>
                                                        <i class="fas fa-chevron-right text-secondary"></i>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Save/Load -->
                                <div class="card-custom">
                                    <div class="card-header-custom">
                                        <h5 class="mb-0"><i class="fas fa-folder me-2"></i>Save & Load</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="mb-3">
                                            <label class="form-label-custom">Scenario Name</label>
                                            <input type="text" class="form-control form-control-custom" 
                                                   id="scenarioName" placeholder="My Scenario">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label-custom">Description</label>
                                            <textarea class="form-control form-control-custom" 
                                                      id="scenarioDescription" rows="2" 
                                                      placeholder="Describe this scenario"></textarea>
                                        </div>
                                        <div class="d-grid gap-2">
                                            <button class="btn btn-simulator" id="saveScenarioBtn">
                                                <i class="fas fa-save me-2"></i>Save Current
                                            </button>
                                            <button class="btn btn-simulator-secondary" id="loadCustomBtn">
                                                <i class="fas fa-upload me-2"></i>Load Custom
                                            </button>
                                            <button class="btn btn-simulator-danger" id="resetScenarioBtn">
                                                <i class="fas fa-undo me-2"></i>Reset Default
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Visualizations -->
                <div class="col-lg-8">
                    <div class="visualization-area">
                        <!-- Visualization Tabs -->
                        <ul class="nav nav-tabs nav-tabs-custom mb-4" id="vizTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="heatmap-tab" data-bs-toggle="tab" 
                                        data-bs-target="#heatmap-viz" type="button">
                                    <i class="fas fa-fire me-2"></i>Heatmap
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="polar-tab" data-bs-toggle="tab" 
                                        data-bs-target="#polar-viz" type="button">
                                    <i class="fas fa-chart-pie me-2"></i>Beam Pattern
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="array-tab-viz" data-bs-toggle="tab" 
                                        data-bs-target="#array-viz" type="button">
                                    <i class="fas fa-th-large me-2"></i>Array View
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="phase-tab" data-bs-toggle="tab" 
                                        data-bs-target="#phase-viz" type="button">
                                    <i class="fas fa-wave-square me-2"></i>Phase View
                                </button>
                            </li>
                        </ul>

                        <!-- Visualization Content -->
                        <div class="tab-content" id="vizTabsContent">
                            <!-- Heatmap Visualization -->
                            <div class="tab-pane fade show active" id="heatmap-viz" role="tabpanel">
                                <div class="canvas-container">
                                    <canvas id="heatmapCanvas"></canvas>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Max Intensity</small>
                                            <span class="h5" id="maxIntensity">1.0</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Main Lobe</small>
                                            <span class="h5" id="mainLobeAngle">0Â°</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <button class="btn btn-simulator w-100" id="exportHeatmapBtn">
                                                <i class="fas fa-download me-1"></i>Export Image
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Polar Pattern -->
                            <div class="tab-pane fade" id="polar-viz" role="tabpanel">
                                <div class="canvas-container">
                                    <canvas id="polarCanvas"></canvas>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Beam Width</small>
                                            <span class="h5" id="measuredBeamWidth">30Â°</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Sidelobe</small>
                                            <span class="h5" id="sidelobeLevel">-13 dB</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Directivity</small>
                                            <span class="h5" id="directivityValue">15 dBi</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <button class="btn btn-simulator w-100" onclick="window.simulator?.takeSnapshot()">
                                                <i class="fas fa-camera me-1"></i>Snapshot
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Array Visualization -->
                            <div class="tab-pane fade" id="array-viz" role="tabpanel">
                                <div class="canvas-container" style="height: 400px;">
                                    <canvas id="arrayCanvas"></canvas>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Active Elements</small>
                                            <span class="h5" id="activeElements">8/8</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Array Length</small>
                                            <span class="h5" id="arrayLength">3.5Î»</span>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="card-custom p-3">
                                            <button class="btn btn-simulator w-100" onclick="window.simulator?.resetPhases()">
                                                <i class="fas fa-redo me-1"></i>Reset Array
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Phase Visualization -->
                            <div class="tab-pane fade" id="phase-viz" role="tabpanel">
                                <div class="canvas-container" style="height: 400px;">
                                    <canvas id="phaseCanvas"></canvas>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Max Phase</small>
                                            <span class="h5" id="maxPhase">0Â°</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Min Phase</small>
                                            <span class="h5" id="minPhase">0Â°</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <small class="text-secondary d-block">Phase RMS</small>
                                            <span class="h5" id="phaseRMS">0Â°</span>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="card-custom p-3">
                                            <button class="btn btn-simulator w-100" onclick="window.simulator?.applyToAllElements()">
                                                <i class="fas fa-copy me-1"></i>Copy to All
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card-custom">
                                    <div class="card-body">
                                        <div class="row align-items-center">
                                            <div class="col-md-8">
                                                <div class="d-flex align-items-center">
                                                    <div class="status-indicator status-active me-3"></div>
                                                    <div>
                                                        <h6 class="mb-1">Simulation Controls</h6>
                                                        <small class="text-secondary">
                                                            Real-time beamforming simulation running
                                                        </small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="d-flex justify-content-end">
                                                    <button class="btn btn-simulator me-2" id="pauseSimBtn">
                                                        <i class="fas fa-pause me-2"></i>Pause
                                                    </button>
                                                    <button class="btn btn-simulator-secondary" id="snapshotBtn">
                                                        <i class="fas fa-camera me-2"></i>Snapshot
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>



    <!-- Tooltip Element -->
    <div id="tooltip" class="tooltip-custom" style="display: none;"></div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <script src="/static/js/beamforman.js"></script>
    
    <!-- Initialize when page loads -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log("ðŸš€ Initializing Beamforming Simulator...");
            
            // Initialize simulator
            window.simulator = new BeamformingSimulator();
            
            // Make loadScenario available globally
            window.loadScenario = (scenarioId) => {
                window.simulator.loadScenario(scenarioId);
                showNotification(`Loaded ${scenarioId} scenario`);
            };
            
            // Initialize tooltips
            initializeTooltips();
            
            // Setup keyboard shortcuts
            setupKeyboardShortcuts();
            
            // Update slider values display
            document.querySelectorAll('input[type="range"]').forEach(slider => {
                const valueId = slider.id + 'Value';
                const valueElement = document.getElementById(valueId);
                if (valueElement) {
                    const suffix = slider.id.includes('Angle') || 
                                   slider.id.includes('rotation') || 
                                   slider.id.includes('phase') ? 'Â°' : '';
                    valueElement.textContent = slider.value + suffix;
                    
                    // Add real-time update
                    slider.addEventListener('input', function() {
                        valueElement.textContent = this.value + suffix;
                    });
                }
            });
            
            // Show curvature control based on initial geometry
            const geometrySelect = document.getElementById('geometryType');
            const curvatureControl = document.getElementById('curvatureControl');
            geometrySelect.addEventListener('change', function() {
                curvatureControl.style.display = this.value === 'curved' ? 'block' : 'none';
            });
            
            // Show welcome message
            setTimeout(() => {
                showNotification('Beamforming Simulator Ready!');
            }, 1000);
        });

        function initializeTooltips() {
            // Add tooltips to controls
            const tooltipElements = document.querySelectorAll('[data-tooltip]');
            tooltipElements.forEach(element => {
                element.addEventListener('mouseenter', function(e) {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.textContent = this.dataset.tooltip;
                    tooltip.style.left = e.pageX + 'px';
                    tooltip.style.top = (e.pageY - 40) + 'px';
                    tooltip.style.display = 'block';
                });
                
                element.addEventListener('mouseleave', function() {
                    document.getElementById('tooltip').style.display = 'none';
                });
                
                element.addEventListener('mousemove', function(e) {
                    const tooltip = document.getElementById('tooltip');
                    tooltip.style.left = e.pageX + 'px';
                    tooltip.style.top = (e.pageY - 40) + 'px';
                });
            });
        }

        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Space to toggle pause/play
                if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    window.simulator?.togglePause();
                }
                
                // Ctrl+S to save
                if (e.ctrlKey && e.code === 'KeyS') {
                    e.preventDefault();
                    document.getElementById('saveScenarioBtn')?.click();
                }
                
                // Ctrl+R to reset
                if (e.ctrlKey && e.code === 'KeyR') {
                    e.preventDefault();
                    document.getElementById('resetPhasesBtn')?.click();
                }
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} position-fixed`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 250px;
                animation: slideIn 0.3s ease;
            `;
            notification.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'} me-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Add CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            
            .alert-success {
                background: var(--accent-green) !important;
                border-color: var(--accent-green) !important;
                color: white !important;
            }
            
            .alert-warning {
                background: var(--caution) !important;
                border-color: var(--caution) !important;
                color: white !important;
            }
        `;
        document.head.appendChild(style);

        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.simulator && window.simulator.initializeCanvases) {
                window.simulator.initializeCanvases();
                if (window.simulator.updateAllVisualizations) {
                    window.simulator.updateAllVisualizations();
                }
            }
        });
    </script>
</body>
</html>